<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <link rel="stylesheet" href="css/console.css">  
</head>
<body>
<div class="input-code-title">
  <button id="save-button" type="button">&#9654; Save</button>
  <button id="run-button" type="button">&#9654; Run</button>
</div>
<div id="editor" style="height: 400px">

var Integer = Java.type("java.lang.Integer");

database.update("DELETE FROM cars");
database.update("INSERT INTO cars VALUES (?)", "ABC1234");
database.update("INSERT INTO cars VALUES (?)", "XYZ9876");

var qtd = database.queryForObject("SELECT COUNT(*) FROM cars", Integer.class);
print('Cars found = '+qtd);

qtd = add(qtd);
print('Cars add = '+qtd);

var cars = database.queryForList("SELECT * FROM cars");
print(cars.size());

for (var x =0; x < cars.size(); x++){
    var car = cars[x];
    print('Car = '+car);
}

</div>

<div class="result-code-title"><span class="title">Console</span></div>

<div id="result" style="height: 200px"></div>

<script src="js/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="js/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
<script src="js/theme-eclipse.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery.blockui.js"></script>

<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/eclipse");
    editor.session.setMode("ace/mode/javascript");

    var result = ace.edit("result");
    result.setTheme("ace/theme/eclipse");

    $("#save-button").on("click", function() {
        $.blockUI();
        $.ajax({
          url: "/console/save",
          type: "POST",
          data: { script: editor.getValue() }
        }).done(function(data) {
        	result.setValue(JSON.stringify(data, null, 2));
        }).fail(function() {
        	result.setValue("Failed to save script.");
        }).always(function() {
          $.unblockUI();
        });
      });
    
    $("#run-button").on("click", function() {
        $.blockUI();
        $.ajax({
          url: "/console/run",
          type: "POST",
          data: { script: editor.getValue() }
        }).done(function(data) {
        	result.setValue(JSON.stringify(data, null, 2));
        }).fail(function() {
        	result.setValue("Failed to run script.");
        }).always(function() {
          $.unblockUI();
        });
      });
    
    </script>

</body>
</html>