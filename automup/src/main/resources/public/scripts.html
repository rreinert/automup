<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <link rel="stylesheet" href="css/console.css">  
</head>
<body>

<div class="input-code-title">
  <button id="open-button" type="button">&#9654; Open</button>
  <button id="save-button" type="button">&#9654; Save</button>
  <button id="run-button" type="button">&#9654; Run</button>
</div>
<div id="editor" style="height: 400px"></div>

<div class="result-code-title"><span class="title">Console</span></div>

<div id="result" style="height: 200px"></div>

<input type="hidden" id="scriptId" value="1"/>

<script src="js/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="js/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
<script src="js/theme-eclipse.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery.blockui.js"></script>

<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/eclipse");
    editor.session.setMode("ace/mode/javascript");

    var result = ace.edit("result");
    result.setTheme("ace/theme/eclipse");
    
    $("#open-button").on("click", function() {
    	
    	var scriptId = $('#scriptId').val();
    	
        $.blockUI();
        $.ajax({
          url: "/console/open",
          type: "POST",
          data: { id: scriptId }
        }).done(function(data) {
        	
        	editor.setValue(data.result, 1);
        	
        }).fail(function() {
        	result.setValue("Failed to open script.");
        }).always(function() {
          $.unblockUI();
        });
    });
    
    $("#save-button").on("click", function() {
        $.blockUI();
        $.ajax({
          url: "/console/save",
          type: "POST",
          data: { script: editor.getValue() }
        }).done(function(data) {
        	result.setValue(JSON.stringify(data, null, 2));
        }).fail(function() {
        	result.setValue("Failed to save script.");
        }).always(function() {
          $.unblockUI();
        });
    });
    
    $("#run-button").on("click", function() {
        $.blockUI();
        $.ajax({
          url: "/console/run",
          type: "POST",
          data: { script: editor.getValue() }
        }).done(function(data) {
        	result.setValue(JSON.stringify(data, null, 2));
        }).fail(function() {
        	result.setValue("Failed to run script.");
        }).always(function() {
          $.unblockUI();
        });
      });
    
    </script>

</body>
</html>